{{#bs-modal
    onSubmit=(action 'reset')
    onHide=(action (mut this.showCancelDialog) false)
    open=this.showCancelDialog
    as |modal|
}}
    {{#modal.header}}
        <h4 class="modal-title">
            <i class="glyphicon glyphicon-alert"></i>
            {{t 'collections.submit.modal_header'}}
        </h4>
    {{/modal.header}}
    {{#modal.body}}
        {{t 'collections.submit.modal_body'}}
    {{/modal.body}}
    {{#modal.footer}}
        {{#bs-button onClick=(action modal.close) type='default'}}
            {{t 'general.cancel'}}
        {{/bs-button}}
        {{#bs-button onClick=(action modal.submit) type='danger'}}
            {{t 'general.ok'}}
        {{/bs-button}}
    {{/modal.footer}}
{{/bs-modal}}
<div class="submit-header" local-class="header">
    <h1>{{t 'collections.submit.header'}}</h1>
</div>
<div local-class="body">
    <div class="container">
        <div class="row m-t-lg">
            {{#cp-panels accordion=true as |panels|}}
                {{#submit-section
                    panels=panels
                    section=sections.project
                    activeSection=activeSection
                    savedSections=savedSections
                    title=(t 'collections.submit.project_select_title')
                    continue=(action 'nextSection' sections.project)
                    as |section|
                }}
                    {{#section.active}}
                        {{collection-item-picker
                            class="col-xs-12"
                            collection=collection
                            projectSelected=(action 'projectSelected')
                            validationChanged=(action (mut isProjectSelectorValid))
                        }}
                    {{/section.active}}
                    {{#section.complete}}
                        <p>
                            <em>{{t 'collections.submit.project_select_project_label'}}</em>
                            <span>{{collectionItem.title}}</span>
                        </p>
                    {{/section.complete}}
                {{/submit-section}}

                {{#submit-section
                    panels=panels
                    section=sections.projectMetadata
                    activeSection=activeSection
                    savedSections=savedSections
                    tooltip=(t 'collections.submit.closed_tooltip')
                    title=(t 'collections.submit.project_metadata_title')
                    description=(t 'collections.submit.project_metadata_description')
                    as |section|
                }}
                    {{#section.active}}
                        {{project-metadata
                            node=collectionItem
                            continue=(action 'nextSection')
                        }}
                    {{/section.active}}
                    {{#section.complete}}
                        <p>
                            <em>{{t 'collections.submit.project_metadata_title_label'}}</em>
                            <span>{{collectionItem.title}}</span>
                        </p>
                        <p>
                            <em>{{t 'collections.submit.project_metadata_description_label'}}</em>
                            <span>{{collectionItem.description}}</span>
                        </p>
                        <p>
                            <em>{{t 'collections.submit.project_metadata_license_label'}}</em>
                            <span>{{collectionItem.license.name}}</span>
                        </p>
                        <p>
                            <em>{{t 'collections.submit.project_metadata_tags_label'}}</em>
                            {{#each collectionItem.tags as |tag|}}
                                <div local-class="subject">{{tag}}</div>
                            {{/each}}
                        </p>
                    {{/section.complete}}
                {{/submit-section}}

                {{#submit-section
                    panels=panels
                    section=sections.projectContributors
                    activeSection=activeSection
                    savedSections=savedSections
                    tooltip=(t 'collections.submit.closed_tooltip')
                    title=(t 'collections.submit.project_contributors_title')
                    description=(t 'collections.submit.project_contributors_description')
                    as |section|
                }}
                    {{#section.active}}
                        {{project-contributors
                            node=collectionItem
                            contributors=collectionItem.contributors
                            discard=(action 'noop')
                            continue=(action 'nextSection')
                        }}
                    {{/section.active}}
                    {{#section.complete}}
                        <p>{{contributor-list contributors=collectionItem.contributors}}</p>
                    {{/section.complete}}
                {{/submit-section}}

                {{#submit-section
                    panels=panels
                    section=sections.collectionSubjects
                    activeSection=activeSection
                    savedSections=savedSections
                    tooltip=(t 'collections.submit.closed_tooltip')
                    title=(t 'collections.submit.subjects_title')
                    description=(t 'collections.submit.subjects_description')
                    as |section|
                }}
                    {{#section.active}}
                        {{subject-picker
                            id='subjects'
                            currentSubjects=collectedMetadatum.subjects
                            model=collectedMetadatum
                            valuePath='subjects'
                            didValidate=didValidate
                            continue=(action 'nextSection')
                        }}
                    {{/section.active}}
                    {{#section.complete}}
                        <div>
                            {{#each collectedMetadatum.subjects as |subject|}}
                                <div local-class="subject">
                                    {{#each subject as |segment|}}
                                        <span>{{segment.text}}</span>
                                    {{/each}}
                                </div>
                            {{/each}}
                        </div>
                    {{/section.complete}}
                {{/submit-section}}

                {{#submit-section
                    panels=panels
                    section=sections.collectionMetadata
                    activeSection=activeSection
                    savedSections=savedSections
                    tooltip=(t 'collections.submit.closed_tooltip')
                    title=(t 'collections.submit.collection_metadata_title')
                    as |section|
                }}
                    {{#section.active}}
                        {{collection-metadata
                            collection=collection
                            collectedMetadatum=collectedMetadatum
                            didValidate=didValidate
                            continue=(action 'nextSection')
                        }}
                    {{/section.active}}
                    {{#section.complete}}
                        {{#each this.choiceFields as |field|}}
                            <p>
                                <em>{{t field.label}}</em>
                                <span>{{field.value}}</span>
                            </p>
                        {{/each}}
                    {{/section.complete}}
                {{/submit-section}}
            {{/cp-panels}}

            <section class="row" local-class="last-buttons">
                <div class="col-xs-12 text-right">
                    <button class="btn btn-default" {{action 'cancel'}}>
                        {{t 'collections.submit.cancel'}}
                    </button>
                    <button class="btn btn-success" {{action (perform save)}} disabled={{not (eq activeSection sections.submit)}}>
                        {{t 'collections.submit.add_to_collection'}}
                    </button>
                </div>
            </section>
        </div>
    </div>
</div>