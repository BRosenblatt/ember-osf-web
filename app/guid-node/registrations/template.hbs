<div class="container" local-class="RegistrationsContainer">
    {{#bs-tab activeId=activeTab onChange=(action changeTab) as |tab|}}
        {{#tab.pane id='registrations' title=(t 'node.registrations.registrations')}}
            <div class="row" local-class="RegistrationsPane">
                <div class="col-xs-9 col-sm-8">
                    <ul class="list-group">
                        {{#paginated-relation
                            modelTaskInstance=model.taskInstance
                            relationshipName='registrations'
                            reload=reloadRegistrations
                            queryParams=registrationsQueryParams
                            analyticsScope='Project Registrations'
                            as |pr|
                        }}
                            {{#pr.item as |registration|}}
                                {{node-blurb node=registration blurbType='registration' showTags=true onClickTag=(action clickTag)}}
                            {{/pr.item}}

                            {{#pr.empty}}
                                <p>{{t 'node.registrations.no_registrations'}}</p>
                                <p>{{t 'node.registrations.start_new'}}</p>
                                <p>{{t 'node.registrations.learn_more' learnMoreLink='http://help.osf.io/m/registrations/l/524205-register-your-project'}}</p>
                            {{/pr.empty}}
                        {{/paginated-relation}}
                    </ul>
                </div>
                {{#if model.taskInstance.value.isAdmin}}
                    <div class="col-xs-3 col-sm-4">
                        {{#bs-button type='success' onClick=(action openNewModal)}}
                            {{t 'node.registrations.new'}}
                        {{/bs-button}}
                        {{#bs-modal size='lg' open=newModalOpen onSubmit=(action 'createDraft') onHidden=(action closeNewModal) as |modal|}}
                            {{#modal.header}}
                                <h4 class="NewRegistrationModal__header">{{t 'node.registrations.new_registration_modal.title'}}</h4>
                            {{/modal.header}}
                            {{#modal.body}}
                                <p class="NewRegistrationModal__info">{{t 'node.registrations.new_registration_modal.info'}}</p>
                                <div class="NewRegistrationModal__schema-list">
                                    {{#if getRegistrationSchemas.isRunning}}
                                        {{#content-placeholders as |placeholder|}}
                                            {{placeholder.list items=8}}
                                        {{/content-placeholders}}
                                    {{else}}
                                        <ul>
                                            {{#each schemas as |schema|}}
                                                <li>
                                                    {{#radio-button value=schema groupValue=selectedSchema changed=(action schemaChanged)}}
                                                        <div>
                                                            {{schema.name}}
                                                            <span>
                                                                {{fa-icon 'info-circle'}}
                                                                {{#bs-tooltip}}{{schema.schema.description}}{{/bs-tooltip}}
                                                            </span>
                                                        </div>
                                                    {{/radio-button}}
                                                </li>
                                            {{/each}}
                                        </ul>
                                    {{/if}}
                                </div>
                            {{/modal.body}}
                            {{#modal.footer}}
                                {{#bs-button onClick=(action modal.close)}}{{t 'general.cancel'}}{{/bs-button}}
                                {{#bs-button onClick=(action modal.submit) type='info'}}{{t 'node.registrations.new_registration_modal.create'}}{{/bs-button}}
                            {{/modal.footer}}
                        {{/bs-modal}}
                        {{#bs-modal size='lg' open=preregModalOpen onSubmit=(action 'createDraft') onHidden=(action closePreregModal) as |modal|}}
                            {{#modal.header}}
                                <h3 class="PreRegChallengeModal__title">{{t 'node.registrations.prereg_modal.title'}}</h3>
                            {{/modal.header}}
                            {{#modal.body}}
                                <h2 class="PreRegChallengeModal__notice">{{t 'node.registrations.prereg_modal.notice'}}</h2>
                                <div class="row m-t-xl">
                                    <div class="col-lg-10 col-lg-offset-1">
                                        <p class="PreRegChallengeModal__eligibility">{{t 'node.registrations.prereg_modal.eligibility' approvedJournalLink=preregLinks.approvedJournal}}</p>
                                        <p class="PreRegChallengeModal__info">{{t 'node.registrations.prereg_modal.info' learnMoreLink=preregLinks.learnMore}}</p>
                                        <ol class="PreRegChallengeModal__list">{{t 'node.registrations.prereg_modal.list' eligibleJournalLink=preregLinks.eligibleJournal embargoedCountriesLink=preregLinks.embargoedCountries termsLink=preregLinks.terms}}</ol>
                                        <label class="PreRegChallengeModal__consent">{{input type="checkbox" change=(action togglePreregConsent)}} {{t 'node.registrations.prereg_modal.consent'}}</label>
                                    </div>
                                </div>
                            {{/modal.body}}
                            {{#modal.footer}}
                                <div class="row">
                                    <div class="col-lg-10 col-lg-offset-1">
                                        {{#bs-button onClick=(action modal.close)}}{{t 'general.cancel'}}{{/bs-button}}
                                        {{#bs-button onClick=(action modal.submit) type='info' disabled=(not preregConsented)}}{{t 'node.registrations.prereg_modal.continue'}}{{/bs-button}}
                                    </div>
                                </div>
                            {{/modal.footer}}
                        {{/bs-modal}}
                    </div>
                {{/if}}
            </div>
        {{/tab.pane}}
        {{#if model.taskInstance.value.isAdmin}}
            {{#tab.pane id='drafts' title=(t 'node.registrations.draft_registrations')}}
                <div class="row" local-class="RegistrationsPane">
                    <div class="col-md-9">
                        <ul class="list-group">
                            {{#paginated-relation
                                modelTaskInstance=model.taskInstance
                                relationshipName='draftRegistrations'
                                reload=reloadDrafts
                                queryParams=draftsQueryParams
                                analyticsScope='Project Draft Registrations'
                                as |pr|
                            }}
                                {{#pr.item as |draftRegistration index onDelete|}}
                                    {{draft-registration-blurb draftRegistration=draftRegistration onDelete=onDelete}}
                                {{/pr.item}}

                                {{#pr.empty}}
                                    <p>{{t 'node.registrations.no_drafts'}}</p>
                                    <p>{{t 'node.registrations.start_new'}}</p>
                                    <p>{{t 'node.registrations.learn_more' learnMoreLink='http://help.osf.io/m/registrations/l/524205-register-your-project'}}</p>
                                {{/pr.empty}}
                            {{/paginated-relation}}
                        </ul>
                    </div>
                </div>
            {{/tab.pane}}
        {{/if}}
    {{/bs-tab}}
</div>
